<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KI-Notdienst – Strom, Wasser & Heizung</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body{margin:0;font-family:'Montserrat',sans-serif;background:#f0f2f5;color:#222;}
h1,h2,h3{margin:0 0 15px;}
button{padding:12px 20px;border:none;border-radius:8px;background:#25d366;color:white;cursor:pointer;transition:0.3s;font-weight:600;}
button:disabled{opacity:0.5;cursor:not-allowed;}
button:hover:not(:disabled){background:#1ebe57;}
nav{display:flex;justify-content:flex-end;gap:25px;padding:15px 20px;background:white;box-shadow:0 2px 8px rgba(0,0,0,0.05);}
nav a{color:#222;text-decoration:none;font-weight:600;cursor:pointer;}
nav a:hover{color:#25d366;}
header{padding:30px 20px;text-align:center;}
header button{font-size:1.1em;}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);justify-content:center;align-items:center;z-index:1000;padding:10px;}
.modal-content{background:white;padding:20px;border-radius:12px;max-width:600px;width:100%;max-height:90vh;overflow:auto;box-shadow:0 6px 15px rgba(0,0,0,0.1);}
input,textarea,select{width:100%;padding:10px;margin:6px 0;border:1px solid #ccc;border-radius:8px;box-sizing:border-box;}
#messages{height:250px;overflow-y:auto;border:1px solid #ccc;padding:10px;margin:10px 0;border-radius:8px;background:white;}
.message{padding:6px 10px;border-radius:10px;margin-bottom:5px;word-break:break-word;}
.message.user{background:#25d366;color:white;text-align:right;}
.message.ai{background:#ffca28;color:#111;text-align:left;}
#progressContainer{width:100%;background:#ddd;border-radius:8px;overflow:hidden;margin:10px 0;}
#progressBar{width:0%;height:15px;background:#25d366;}
#countdown{font-weight:bold;margin-bottom:10px;}
footer{padding:15px;text-align:center;background:#111;color:#ffca28;font-size:14px;}
footer a{color:#ffca28;text-decoration:none;margin:0 8px;}
footer a:hover{text-decoration:underline;}
#startSpeechBtn{width:50px;padding:10px;text-align:center;font-size:18px;}
.feature-section{padding:40px 20px;background:#fff;}
.feature-section h2{text-align:center;margin-bottom:30px;font-size:2em;}
.feature-cards{display:flex; flex-wrap:wrap; justify-content:center; gap:20px;}
.feature-card{flex:1 1 250px; max-width:300px; background:#f7f7f7; border-radius:12px; padding:20px; box-shadow:0 4px 15px rgba(0,0,0,0.1); text-align:center; transition:0.3s; cursor:pointer;}
.feature-card:hover{transform:translateY(-5px); box-shadow:0 8px 20px rgba(0,0,0,0.15);}
.feature-card svg{width:50px; height:50px; margin-bottom:15px;}
@media(max-width:900px){.feature-card{flex:1 1 45%;}}
@media(max-width:600px){.feature-card{flex:1 1 100%;}}
</style>
</head>
<body>

<nav>
  <a href="#">Impressum</a>
  <a href="#">Datenschutz</a>
  <a href="#">AGB</a>
</nav>

<header>
<h1>⚡ KI-Notdienst – Strom, Wasser & Heizung</h1>
<p>Starten Sie die Soforthilfe mit Ihrem persönlichen Zugang.</p>
<button id="openCustomerBtn">Soforthilfe anfordern – 39,99 €</button>
</header>

<section class="feature-section">
<h2>Unsere Leistungen auf einen Blick</h2>
<div class="feature-cards">
  <div class="feature-card"><h3>Elektrik-Notdienst</h3></div>
  <div class="feature-card"><h3>Wasser-Notdienst</h3></div>
  <div class="feature-card"><h3>Heizungs-Notdienst</h3></div>
  <div class="feature-card"><h3>KI-gestützte Analyse</h3></div>
</div>
</section>

<!-- Kundendaten Modal -->
<div class="modal" id="customerModal">
<div class="modal-content">
<h2>Notdienst Anfrage</h2>
<input id="name" placeholder="Vor- und Nachname">
<input id="address" placeholder="Adresse">
<input id="phone" placeholder="Telefonnummer">
<input id="email" placeholder="E-Mail-Adresse">
<label><input type="checkbox" id="consent"> Ich akzeptiere die Datenschutzerklärung</label>
<select id="serviceType">
  <option value="">-- Bitte wählen --</option>
  <option value="electricity">Elektrik</option>
  <option value="water">Wasser</option>
  <option value="heating">Heizung</option>
</select>
<textarea id="problem" placeholder="Beschreiben Sie Ihr Problem..."></textarea>
<button id="startKiBtn" disabled>KI-Triage starten</button>
<button onclick="closeCustomerModal()">Zurück</button>
</div>
</div>

<footer>
© 2026 KI-Notdienst
</footer>

<script type="module">
// Supabase direkt einbinden
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

// **Direkt gesetzte Keys für Testzwecke**
const supabaseUrl = "https://ywqwbbqluabciojvczxm.supabase.co"
const supabaseKey = "sb_secret_taQVSkOzyZK-FYU0y2Fsvg_9sn8fKh2"
const supabase = createClient(supabaseUrl, supabaseKey)

// Modal öffnen
const customerModal = document.getElementById('customerModal')
const openCustomerBtn = document.getElementById('openCustomerBtn')
const startKiBtn = document.getElementById('startKiBtn')
const nameEl = document.getElementById('name')
const addressEl = document.getElementById('address')
const phoneEl = document.getElementById('phone')
const emailEl = document.getElementById('email')
const consentEl = document.getElementById('consent')
const serviceTypeEl = document.getElementById('serviceType')
const problemEl = document.getElementById('problem')

openCustomerBtn.addEventListener('click', ()=>{customerModal.style.display='flex'})
function closeCustomerModal(){customerModal.style.display='none'}

// Button aktivieren
[nameEl,addressEl,phoneEl,emailEl,consentEl,serviceTypeEl,problemEl].forEach(el=>{
  el.addEventListener('input', updateStartKiBtn)
  el.addEventListener('change', updateStartKiBtn)
})
function updateStartKiBtn(){
  startKiBtn.disabled = !(nameEl.value && addressEl.value && phoneEl.value && consentEl.checked && serviceTypeEl.value && problemEl.value)
}

// KI-Triage speichern
startKiBtn.addEventListener('click', async ()=>{
  const { data, error } = await supabase.from('ki_notdienst').insert([{
    name: nameEl.value,
    adresse: addressEl.value,
    telefon: phoneEl.value,
    email: emailEl.value,
    service: serviceTypeEl.value,
    problem: problemEl.value,
    image_paths: []
  }])
  if(error){alert('Fehler beim Speichern: '+error.message); return;}
  alert('Daten erfolgreich gespeichert!')

  // WhatsApp Call
  const whatsappNumber = "4915145932462" // Beispielnummer
  const message = `Ich möchte einen Live-Video-Call für den Notdienst buchen. Service: ${serviceTypeEl.value}`
  window.open(`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`, '_blank')

  closeCustomerModal()
})
</script>

</body>
</html>
