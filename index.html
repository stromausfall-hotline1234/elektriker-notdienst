<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KI-Notdienst ‚Äì Strom, Wasser & Heizung</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body{margin:0;font-family:'Montserrat',sans-serif;background:#f0f2f5;color:#222;}
h1,h2,h3{margin:0 0 15px;}
button{padding:12px 20px;border:none;border-radius:8px;background:#25d366;color:white;cursor:pointer;transition:0.3s;font-weight:600;}
button:disabled{opacity:0.5;cursor:not-allowed;}
button:hover:not(:disabled){background:#1ebe57;}
nav{display:flex;justify-content:flex-end;gap:25px;padding:15px 20px;background:white;box-shadow:0 2px 8px rgba(0,0,0,0.05);}
nav a{color:#222;text-decoration:none;font-weight:600;cursor:pointer;}
nav a:hover{color:#25d366;}
header{padding:30px 20px;text-align:center;}
header button{font-size:1.1em;}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);justify-content:center;align-items:center;z-index:1000;padding:10px;}
.modal-content{background:white;padding:20px;border-radius:12px;max-width:600px;width:100%;max-height:90vh;overflow:auto;box-shadow:0 6px 15px rgba(0,0,0,0.1);}
.summary{background:#f7f7f7;padding:12px;border-radius:8px;font-size:14px;margin-bottom:10px;white-space:pre-wrap;}
.info-box{background:#fff3cd;padding:12px;border-radius:8px;border:1px solid #ffeeba;margin-bottom:12px;font-size:14px;display:none;}
input,textarea,select{width:100%;padding:10px;margin:6px 0;border:1px solid #ccc;border-radius:8px;box-sizing:border-box;}
#messages{height:250px;overflow-y:auto;border:1px solid #ccc;padding:10px;margin:10px 0;border-radius:8px;background:white;}
.message{padding:6px 10px;border-radius:10px;margin-bottom:5px;word-break:break-word;}
.message.user{background:#25d366;color:white;text-align:right;}
.message.ai{background:#ffca28;color:#111;text-align:left;}
#progressContainer{width:100%;background:#ddd;border-radius:8px;overflow:hidden;margin:10px 0;}
#progressBar{width:0%;height:15px;background:#25d366;}
#countdown{font-weight:bold;margin-bottom:10px;}
footer{padding:15px;text-align:center;background:#111;color:#ffca28;font-size:14px;}
footer a{color:#ffca28;text-decoration:none;margin:0 8px;}
footer a:hover{text-decoration:underline;}
#startSpeechBtn{width:50px;padding:10px;text-align:center;font-size:18px;}
@media(max-width:600px){
  .modal-content{padding:15px;}
  button{width:100%;margin-top:8px;}
  nav{flex-direction:column;align-items:flex-start;}
  header{padding:20px 10px;}
}
</style>
</head>
<body>

<nav>
  <a href="impressum.html" target="_blank">Impressum</a>
  <a href="datenschutz.html" target="_blank">Datenschutz</a>
  <a href="agb.html" target="_blank">AGB</a>
</nav>

<header>
<h1>‚ö° KI-Notdienst ‚Äì Strom, Wasser & Heizung</h1>
<p>Starten Sie die Soforthilfe mit Ihrem pers√∂nlichen Zugang.</p>
<button id="openCustomerBtn">Soforthilfe anfordern ‚Äì 39,99 ‚Ç¨</button>
</header>

<!-- Kundendaten Modal -->
<div class="modal" id="customerModal">
<div class="modal-content">
<h2>Notdienst Anfrage</h2>
<input id="name" placeholder="Vor- und Nachname">
<input id="address" placeholder="Adresse">
<input id="phone" placeholder="Telefonnummer">
<input id="email" placeholder="E-Mail-Adresse">
<label><input type="checkbox" id="consent"> Ich akzeptiere die <a href="#" onclick="showInfo('datenschutz','modalInfoBoxCustomer');return false;">Datenschutzerkl√§rung</a></label>
<div id="modalInfoBoxCustomer" class="info-box"></div>

<hr>
<label for="serviceType">Service-Typ ausw√§hlen:</label>
<select id="serviceType">
  <option value="">-- Bitte w√§hlen --</option>
  <option value="electricity">Elektrik</option>
  <option value="water">Wasser</option>
  <option value="heating">Heizung</option>
</select>

<button id="startKiBtn" disabled>KI-Triage starten</button>
<button onclick="closeCustomerModal()">Zur√ºck</button>
</div>
</div>

<!-- KI Chat Modal -->
<div class="modal" id="kiModal">
<div class="modal-content">
<h2>KI-Assistenz</h2>
<div class="info-box" style="display:block;">‚ö† Die KI sammelt Informationen f√ºr den Fachmann. Arbeiten k√∂nnen gef√§hrlich sein.</div>
<div id="messages"></div>
<button id="startSpeechBtn">üé§</button>
<input type="text" id="userInput" placeholder="Beschreiben Sie Ihr Problem...">
<button id="sendBtn">Senden</button>
<input type="file" id="fileInputKI" accept="image/*" multiple><br>
<div id="countdown">02:00</div>
<div id="progressContainer">
<div id="progressBar"></div>
</div>
</div>
</div>

<!-- Fachmann Modal -->
<div class="modal" id="expertModal">
<div class="modal-content">
<h2>Fachmann-Best√§tigung</h2>
<p>Die KI hat ein gr√∂√üeres Problem erkannt. Ein Fachmann wird Sie nun anrufen.</p>
<label>Schwierigkeitsgrad Bewertung:</label>
<select id="difficultyLevel">
  <option value="1">1 ‚Äì Leicht</option>
  <option value="2">2 ‚Äì Mittel</option>
  <option value="3">3 ‚Äì Komplex</option>
  <option value="4">4 ‚Äì Kritisch</option>
</select>
<button id="confirmExpertBtn">Best√§tigen & Videocall starten</button>
<button onclick="closeExpertModal()">Zur√ºck</button>
</div>
</div>

<footer>
¬© 2026 KI-Notdienst
</footer>

<script>
// Rechtstexte
const infoTexts={datenschutz:`<strong>Datenschutzerkl√§rung</strong><br>Wir speichern Ihre Daten ausschlie√ülich f√ºr R√ºckruf und Video-Beratung. Weitergabe an Dritte erfolgt nicht.`};
function showInfo(type,id){document.getElementById(id).innerHTML=infoTexts[type]+`<br><button onclick="this.parentElement.style.display='none'">Schlie√üen</button>`; document.getElementById(id).style.display='block';}

// Elemente
const customerModal=document.getElementById("customerModal");
const openCustomerBtn=document.getElementById("openCustomerBtn");
const nameEl=document.getElementById("name");
const addressEl=document.getElementById("address");
const phoneEl=document.getElementById("phone");
const emailEl=document.getElementById("email");
const consentEl=document.getElementById("consent");
const serviceTypeEl=document.getElementById("serviceType");
const startKiBtn=document.getElementById("startKiBtn");

const kiModal=document.getElementById("kiModal");
const messagesEl=document.getElementById("messages");
const userInputEl=document.getElementById("userInput");
const sendBtn=document.getElementById("sendBtn");
const fileInputKI=document.getElementById("fileInputKI");
const progressBar=document.getElementById("progressBar");
const countdownEl=document.getElementById("countdown");

const expertModal=document.getElementById("expertModal");
const confirmExpertBtn=document.getElementById("confirmExpertBtn");

// Modal Funktionen
openCustomerBtn.addEventListener("click",()=>customerModal.style.display="flex");
function closeCustomerModal(){customerModal.style.display="none";}
function closeExpertModal(){expertModal.style.display="none";}

// Aktivierung Start KI Button
[nameEl,addressEl,phoneEl,emailEl,consentEl,serviceTypeEl].forEach(el=>{el.addEventListener("input",updateStartKiBtn); el.addEventListener("change",updateStartKiBtn);});
function updateStartKiBtn(){startKiBtn.disabled=!(nameEl.value && addressEl.value && phoneEl.value && emailEl.value && consentEl.checked && serviceTypeEl.value);}

// KI Fragen
const questions={
  electricity:["Ist der FI-Schalter ausgel√∂st?","Ist eine Sicherung durchgebrannt?","Komplettausfall vorhanden?","H√∂ren Sie ungew√∂hnliche Ger√§usche oder Funken?"],
  water:["Gibt es einen Rohrbruch oder ein Leck?","Kein Wasser vorhanden?","Tropft irgendwo Wasser?","Pumpe defekt?"],
  heating:["Heizung kalt?","Thermostat defekt?","Warmwasser funktioniert nicht?","Heizung ungleichm√§√üig?"]
};
let currentQuestionIndex=0;
let kiTimer, kiProgressInterval, kiDuration=120;

// Start KI Session
function startKiSession(){
  kiModal.style.display="flex";
  messagesEl.innerHTML="";
  addMessage("KI: Hallo! Ich werde Ihr Problem analysieren und wichtige Informationen sammeln.","ai");
  currentQuestionIndex=0;
  askNextQuestion();
  let timeLeft=kiDuration; progressBar.style.width='0%'; countdownEl.innerText=formatTime(timeLeft);
  kiTimer=setTimeout(endKiSession, kiDuration*1000);
  kiProgressInterval=setInterval(()=>{timeLeft--; progressBar.style.width=((kiDuration-timeLeft)/kiDuration*100)+'%'; countdownEl.innerText=formatTime(timeLeft); if(timeLeft<=0) clearInterval(kiProgressInterval);},1000);
}

function askNextQuestion(){
  const service=serviceTypeEl.value;
  if(!service || currentQuestionIndex>=questions[service].length){addMessage("KI: Vielen Dank. Ich habe alle wichtigen Informationen erfasst.","ai"); return;}
  addMessage("KI: "+questions[service][currentQuestionIndex],"ai");
}

// KI Antwort
sendBtn.addEventListener("click",()=>{
  const txt=userInputEl.value.trim(); if(!txt) return;
  addMessage(txt,"user"); userInputEl.value="";
  addMessage("KI: Danke, n√§chste Frage...","ai");
  currentQuestionIndex++; askNextQuestion();
});
userInputEl.addEventListener("keypress",e=>{if(e.key==="Enter") sendBtn.click();});

// Bilder KI
fileInputKI.addEventListener("change",e=>{
  Array.from(e.target.files).forEach(file=>{
    const reader=new FileReader();
    reader.onload=function(ev){addMessage("Bild hochgeladen: "+file.name,"user"); setTimeout(()=>{addMessage("KI: Bild erhalten und analysiert.","ai");},500);}
    reader.readAsDataURL(file);
  });
});

// KI beenden
function endKiSession(){kiModal.style.display="none"; clearInterval(kiProgressInterval); expertModal.style.display="flex";}
function formatTime(sec){return `${String(Math.floor(sec/60)).padStart(2,'0')}:${String(sec%60).padStart(2,'0')}`;}

// Fachmann WhatsApp
confirmExpertBtn.addEventListener("click",()=>{
  const level=document.getElementById("difficultyLevel").value;
  const whatsappNumber="4915145932462";
  const message=`Ich m√∂chte einen Live-Video-Call f√ºr den Notdienst buchen. Service: ${serviceTypeEl.value}, Schwierigkeitsgrad: ${level}`;
  window.open(`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`,"_blank");
  expertModal.style.display="none";
});

// Payment simuliert
startKiBtn.addEventListener("click",()=>{closeCustomerModal(); startKiSession();});

// Push-to-Talk Sprachinteraktion
let recognition;
if('webkitSpeechRecognition' in window || 'SpeechRecognition' in window){
  const SpeechRecognition=window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition=new SpeechRecognition();
  recognition.lang='de-DE';
  recognition.interimResults=false;
  recognition.maxAlternatives=1;
  recognition.onresult=function(event){
    const transcript=event.results[0][0].transcript;
    addMessage(transcript,"user"); sendBtn.click();
  }
  recognition.onerror=function(event){console.error("SpeechRecognition error:",event.error);}
}

const startSpeechBtn=document.getElementById("startSpeechBtn");
startSpeechBtn.addEventListener("mousedown",()=>{if(!recognition)return alert("Spracherkennung nicht unterst√ºtzt."); recognition.start();});
startSpeechBtn.addEventListener("mouseup",()=>{if(!recognition)return; recognition.stop();});

// Text-to-Speech
function speak(text){if('speechSynthesis' in window){const utter=new SpeechSynthesisUtterance(text);utter.lang='de-DE';window.speechSynthesis.speak(utter);}}
function addMessage(content,sender){const div=document.createElement("div");div.className="message "+sender;div.innerText=content;messagesEl.appendChild(div);messagesEl.scrollTop=messagesEl.scrollHeight; if(sender==="ai") speak(content);}
</script>
</body>
</html>
